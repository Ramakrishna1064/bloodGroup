package com.ensis.bloodgroup.dao;

import java.util.List;

import org.hibernate.Criteria;
import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.hibernate.criterion.Projections;
import org.hibernate.criterion.Restrictions;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Repository;

import com.ensis.bloodgroup.dto.DonarsDTO;
import com.ensis.bloodgroup.dto.DonateRequestDTO;
import com.ensis.bloodgroup.dto.OrganizationDTO;
import com.ensis.bloodgroup.dto.RequestedDonorsListDTO;


@Repository
public class ListOfServicesDAO {

	
	@Autowired
	HibernateUtil hibernateUtil;

	@Autowired
	private SessionFactory sessionFactory;
	
	public List<?> getRequest(int donorId)
	{
		Session session = sessionFactory.getCurrentSession();
		Criteria criteria = session.createCriteria(RequestedDonorsListDTO.class);
		criteria.add(Restrictions.eq("donorid", donorId));
		// result will stored in list object.
		List<?> list = criteria.list();
		session.flush();
		session.clear();
		return list;
	}
	public DonateRequestDTO getRequestDetails(int reqId)
	{
		Session session = sessionFactory.getCurrentSession();
		Criteria criteria = session.createCriteria(DonateRequestDTO.class);
		criteria.add(Restrictions.eq("requestid", reqId));
		// result will stored in list object.
		List<?> list = criteria.list();
		DonateRequestDTO donateRequestDTO = null;
		if(list.size()>0)
		{
			donateRequestDTO=(DonateRequestDTO) list.get(0);
		}
		session.flush();
		session.clear();
		return donateRequestDTO;
	}
	public List<?> getRequestedOrganizationDetails(int requestOrgId)
	{
		Session session = sessionFactory.getCurrentSession();
		Criteria criteria = session.createCriteria(OrganizationDTO.class);
		criteria.add(Restrictions.eq("organizationid", requestOrgId));
		// result will stored in list object.
		List<?> list = criteria.list();
		session.flush();
		session.clear();
		return list;
	}
	public int setSentDonorForUser(RequestedDonorsListDTO reqOj) {

		Object obj = hibernateUtil.create(reqOj);
		if (obj != null) {
			Session session = sessionFactory.getCurrentSession();
			int donorreqid = (Integer) session.createCriteria(RequestedDonorsListDTO.class).setProjection(Projections.max("donorreqid")).uniqueResult();
			session.flush();
			session.clear();
			return donorreqid;

		} else {

			return 0;
		}
	}
	public List<?> setRequestStatus(int donorreqid) {

		System.out.println("..................>>>>"+donorreqid);
		Session session = sessionFactory.getCurrentSession();
		Criteria criteria = session.createCriteria(RequestedDonorsListDTO.class);
		criteria.add(Restrictions.eq("donorreqid", donorreqid));
		// result will stored in list object.
		List<?> list = criteria.list();
		session.flush();
		session.clear();
		return list;
	}
	public boolean updateStatus(RequestedDonorsListDTO requestedDonorsListDTO) {

		boolean response = false;
		Session session = sessionFactory.getCurrentSession();
		RequestedDonorsListDTO rrequestedDonorsListDTO = (RequestedDonorsListDTO) session.get(RequestedDonorsListDTO.class, requestedDonorsListDTO.getDonorreqid());
		session.flush();
		session.clear();
		if (rrequestedDonorsListDTO != null) {
			rrequestedDonorsListDTO.setRequeststatus(requestedDonorsListDTO.getRequeststatus());;
			hibernateUtil.update(rrequestedDonorsListDTO);
			response = true;
		} else {
			response = false;
		}
		return response;
	}
	public List<?> getListOfAcceptedDonors(int acceptorId)
	{
		Session session = sessionFactory.getCurrentSession();
		Criteria criteria = session.createCriteria(RequestedDonorsListDTO.class);
		criteria.add(Restrictions.eq("organizationid", acceptorId));
		criteria.add(Restrictions.eq("requeststatus", 2));
		// result will stored in list object.
		List<?> list = criteria.list();
		session.flush();
		session.clear();
		return list;
	}
	public List<?> getacceptedDonorDetails(int donorId)
	{
		Session session = sessionFactory.getCurrentSession();
		Criteria criteria = session.createCriteria(DonarsDTO.class);
		criteria.add(Restrictions.eq("donarid", donorId));
		// result will stored in list object.
		List<?> list = criteria.list();
		session.flush();
		session.clear();
		return list;
	}
	
	
	
}
